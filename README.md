# Wife Image 桌宠助手（老婆桌宠）/多模态中（桌面强化端）

## 插件介绍

1.Wife Image 是一个为聊天框架提供桌面形象的插件，可以在 Windows 系统上显示可交互的透明角色形象。插件支持自动扫描图片目录，动态加载表情，以及独立的文本对话框显示。现在还支持TTS语音播放功能，让桌面形象拥有声音！
2.一个用于 langbot 的大型插件，多模态中部（其他为多模态模型能力强化部分以及多模态下部用户能力强化）该插件为中部桌面端能力强化也就是电脑控制端。

## 功能特点

1. **桌面形象展示**：在 Windows 桌面显示可爱的形象
2. **鼠标交互**：支持拖动形象位置和滚轮缩放大小
3. **表情切换**：根据对话内容自动切换形象表情
4. **独立对话框**：在形象上方显示对话内容
5. **右键菜单**：可通过右键菜单设置窗口置顶等功能
6. **自动扫描表情**：自动扫描image目录下的所有图片，动态生成表情配置
7. **持久化配置**：记住窗口位置和置顶状态
8. **TTS语音功能**：通过API将文本转换为语音，使桌面形象能够说话
9. **语音消息发送**：不仅在桌面上播放语音，同时也将语音消息发送到聊天窗口


# 求助

1. 请求绘画/动画大佬的帮忙，制作一个可爱的老婆形象，谢谢！！
2. 理论上来说可以支持任何形象，只要能画出来，后续会添加live2D方法以及多种点击事件和动态动画！！但是需要大佬的帮忙！！
3. 当前图片均为AI生成，如果大佬有更好的图片，可以发给我，谢谢！！直接拉pr就行！也可以直接发给我，谢谢！！
4. 如果有live2D大佬，可以帮忙制作一个live2D模型，谢谢！！


## 自动安装方法

发送以下命令给bot即可自动安装
```
!plugin get https://github.com/sanxianxiaohuntun/Wife_Image
```

## 手动安装方法

1. 将插件文件夹放置在框架的 `plugins` 目录下
2. 确保创建了 `image` 子目录用于存放表情图片
3. 确保创建了 `audio_cache` 子目录用于存放语音缓存
4. 确保包含 `ffmpeg` 子目录，内含 `ffmpeg.exe` 和 `silk_v3_encoder.exe`
5. 安装依赖：`pip install -r requirements.txt`
6. 重启框架或手动加载插件

## 重要事项

1. 本插件需要使用启航AI的TTS服务，所以需要使用启航AI的API密钥，请自行申请！！https://api.qhaigc.net/
2. 如果提供桌宠**动态形象**和**live2D**模型的大佬可以**免费使用启航AI**的全部服务（我买单 100刀）
3. 后续（下方规划）本插件所有模型均使用启航AI的模型，所以需要使用启航AI的API密钥，请自行申请！！https://api.qhaigc.net/

## 未来功能规划

我们正在规划一系列激动人心的新功能，期待您的参与和反馈！以下是我们的发展路线图及当前进度：

### 🔄 消息互动与监听 【40%】

**状态**：进行中 ⚠️

- **智能消息管理**：监听主人QQ消息，记录未读消息并智能回复 [已完成框架 ✓]
- **休眠状态提醒**：当用户回到电脑时，桌宠会贴心提醒未读消息 [开发中 ⚠️]
- **消息摘要**：自动生成消息摘要，提供总结版和完整版查看选项 [规划中 ❌]

> **技术进展**：基础HTTP框架接口已接入，消息记录数据库已设计，系统活动监测模块正在开发中。

### 🎤 语音互动系统 【85%】

**状态**：即将完成 ✓

- **TTS语音输出**：将文本转换为语音并通过桌宠播放 [已完成 ✓]
- **音频处理与转换**：处理音频格式和质量，支持多种语音风格 [已完成 ✓]
- **实时语音对话**：支持用户与桌宠进行实时语音交流 [已完成 ✓]
- **语音转文本**：将用户语音转换为文本进行处理 [解决方案已确定 ⚠️]
- **语音指令识别**：通过语音发出指令，让桌宠执行相应操作 [已完成 ✓]
- **情绪识别**：能够从语音中识别用户情绪，做出相应回应 [部分完成 ⚠️]

> **技术进展**：语音播放系统已完全实现并集成启航AI的TTS服务。音频处理和转换功能运行良好，支持QQ/微信语音消息格式。关于语音转文本功能，我们已确定使用启航AI提供的语音转文本API服务，该服务与TTS使用相同的API平台，集成工作正在最后阶段。音频转写和翻译功能已准备就绪，只待语音转文本模块完成集成。

### 🎬 动态视觉效果 【60%】

**状态**：部分实现 ⚠️

- **动态表情**：支持GIF和短视频作为桌宠表情 [已完成 ✓]
- **情境动画**：根据对话内容展示相应的动态反应 [部分完成 ⚠️]
- **过渡效果**：表情切换时添加平滑过渡效果 [规划中 ❌]

> **技术进展**：基础GIF/WebP支持已实现，使用PyQt5的QMovie类成功加载动画，正在优化动画状态转换系统。

### 👑 Live2D支持 【30%】

**状态**：后端已实现 ⚠️

- **动态模型渲染**：支持Live2D模型的加载和渲染 [已完成 ✓]
- **物理效果**：头发、衣物等随动作自然摆动 [规划中 ❌]
- **丰富表情**：支持多种面部表情和动作组合 [部分完成 ⚠️]

> **瓶颈**：目前需要Live2D模型资源，代码已实现但需调试。如果您是Live2D模型设计师，我们非常欢迎您的加入！

### 👆 多区域互动 【35%】

**状态**：开发中 ⚠️

- **区域点击响应**：不同身体部位有不同反应 [基础功能已完成 ✓]
- **自定义互动**：允许用户定义点击特定区域的反应 [部分完成 ⚠️]
- **组合动作**：支持连续点击触发特殊动作 [规划中 ❌]

> **技术进展**：基础点击事件检测和简单区域响应系统已实现，正在开发区域定义工具，需要标准化桌宠形象。

### 📷 摄像头互动 【5%】

**状态**：评估中 ⚠️

- **表情跟踪**：识别用户表情并做出回应 [规划中 ❌]
- **动作识别**：可以识别简单手势和动作 [规划中 ❌]
- **隐私保护**：严格的隐私保护机制，所有数据本地处理 [概念设计中 ⚠️]

> **技术挑战**：正在评估OpenCV实现人脸识别的可行性，重点关注用户隐私保护机制设计。

### 🔄 Waifu联动 【25%】

**状态**：已达成合作 ⚠️

- **长期记忆**：桌宠能够记住与用户的互动历史 [接口设计中 ⚠️]
- **角色定制**：支持通过YAML配置自定义桌宠性格和设定 [规划中 ❌]
- **多角色切换**：轻松切换不同角色和性格设定 [规划中 ❌]
- **思维链系统**：增强桌宠的逻辑思考能力，使反应更加自然 [规划中 ❌]

> **技术进展**：已与Waifu插件作者达成合作，完成初步接口设计，共享配置系统开发中。

### 🌐 多模态能力 【35%】

**状态**：积极开发中 ⚠️

#### 桌面助手功能 【30%】
- **桌面监控**：理解用户正在进行的活动，提供情境化帮助 [概念验证完成 ✓]
- **窗口管理**：帮助用户管理和切换窗口 [原型开发中 ⚠️]
- **屏幕内容分析**：理解屏幕内容并提供相关建议 [基础功能已实现 ✓]
- **系统状态监测**：监控CPU、内存使用等系统状态 [规划中 ❌]

#### 多媒体处理能力 【55%】
- **图像生成与处理** [大部分实现 ✓]
  - 二次元风格图像生成 [已完成 ✓]
  - 写实风格图像生成 [已完成 ✓]
  - 图像分析和识别 [已完成 ✓]
  - 图像标注和编辑 [开发中 ⚠️]
  
- **音频处理与分析** [大部分实现 ✓]
  - 音乐播放和控制 [已完成 ✓]
  - 音频内容识别 [已完成 ✓]
  - 音频转写和翻译 [技术就绪，等待语音转文本 ⚠️]
  - 背景噪音过滤 [开发中 ⚠️]
  
- **视频内容处理** [大部分实现 ✓]
  - 视频播放和控制 [已完成 ✓]
  - 视频内容分析 [已完成 ✓]
  - 视频生成和编辑 [规划中 ❌]

#### 创意与生产力工具 【25%】
- **代码开发辅助** [聊天端已完成 ✓]
  - Python代码生成与分析 [已完成 ✓]
  - Java/C++代码辅助 [已完成 ✓]
  - 前端代码（HTML/CSS/JS）生成 [已完成 ✓]
  - 数据库查询生成 [已完成 ✓]
  - 桌面端集成 [规划中 ❌]
  
- **网站与应用开发** [聊天端已完成 ✓]
  - 静态网页生成 [已完成 ✓]
  - 响应式设计辅助 [已完成 ✓]
  - 移动端界面设计 [已完成 ✓]
  - 桌面端集成 [规划中 ❌]
  
- **数据处理与可视化** [部分实现 ⚠️]
  - 数据分析助手 [已完成 ✓]
  - 图表生成与优化 [开发中 ⚠️]
  - 报表自动生成 [开发中 ⚠️]
  
- **文档与报告生成** [部分实现 ⚠️]
  - 文本报告分析 [已完成 ✓]
  - PPT演示文稿辅助 [开发中 ⚠️]
  - Excel数据分析 [开发中 ⚠️]
  
- **游戏互动助手** [概念阶段 ❌]
  - 游戏伙伴对话 [概念设计中 ❌]
  - 游戏策略建议 [概念设计中 ❌]
  - 简单游戏辅助命令 [概念设计中 ❌]

> **开发进展**：多模态功能架构已完成重构，在多个核心领域取得突破性进展。图像、音频、视频基础处理模块已基本完成，其中图像分析识别、视频内容分析已全面实现。代码开发辅助和网站应用开发在聊天端已实现全部功能，桌面端集成正在规划中。数据处理方面已完成分析功能，可视化工具正在开发。语音相关功能全面集成启航AI服务，将实现完整的语音互动体验。与启航AI的深度合作为本项目提供了全方位的AI能力支持，包括TTS、STT、图像生成和代码辅助等多项服务。多模态插件框架4.0发布后，将优先实现桌面端代码辅助集成和完善数据处理能力。

## 总体开发进度

| 功能模块 | 完成度 | 状态 |
|---------|--------|------|
| 基础桌面形象和TTS语音 | 90% | 主要功能已实现 ✓ |
| 消息互动与监听 | 40% | 进行中 ⚠️ |
| 语音互动系统 | 85% | 即将完成 ✓ |
| 动态视觉效果 | 60% | 部分实现 ⚠️ |
| Live2D支持 | 30% | 后端已实现 ⚠️ |
| 多区域互动 | 35% | 开发中 ⚠️ |
| 摄像头互动 | 5% | 评估中 ⚠️ |
| Waifu联动 | 25% | 已达成合作 ⚠️ |
| 多模态能力 | 35% | 大部分核心功能已实现 ✓ |
| **整体完成度** | **48%** | **积极开发中** |

我们欢迎所有对项目感兴趣的开发者、设计师和创作者加入！特别是如果您能提供角色设计、动画制作或Live2D模型，您将获得额外支持！

### 表情管理

只需将表情图片放入 `image` 目录，插件会自动扫描并加载：

- 每次启动插件时，将自动扫描图片目录
- 图片文件名（不含扩展名）将作为表情名称
- 支持的格式：jpg, jpeg, png, gif, webp
- 如果删除了图片，对应的表情也会被自动移除
- 新增图片后，相应的表情会被自动添加

### 表情使用

大模型可以在回复中切换桌宠形象。

### TTS语音功能

当形象显示表情和文本时，同时会：
1. 在桌面形象上播放相应的语音
2. 将语音消息发送到聊天窗口

语音生成会自动：
- 移除中英文括号及括号内容
- 对特殊符号和数字进行处理，使语音更自然
- 限制最大字数，默认为300字

### 交互方式

- **左键拖动**：移动形象位置
- **鼠标滚轮**：放大或缩小形象
- **右键菜单**：打开功能菜单（可设置置顶、重置大小等）

## 配置说明

插件使用 `config.yaml` 文件进行配置，支持多种设置：

### 窗口配置
```yaml
window:
  always_on_top: true  # 是否置顶窗口
  default_width: 240   # 默认窗口宽度
  default_height: 320  # 默认窗口高度
  opacity: 1         # 窗口透明度
  drag_enabled: true   # 是否允许拖动
  resize_enabled: true # 是否允许缩放
```

### 对话气泡配置
```yaml
chat_bubble:
  font_size: 12        # 对话框字体大小
  max_width: 300       # 对话框最大宽度
  max_lines: 5         # 最大显示行数
  max_chars_per_line: 30  # 每行最大字符数
  background_color: "rgba(255, 255, 255, 0.85)" # 对话框背景色
  text_color: "rgb(0, 0, 0)" # 对话框文字颜色
  border_radius: 10    # 对话框圆角半径
  padding: 10          # 对话框内边距
  show_duration: 5     # 对话框显示时间（秒）
```

### TTS语音配置
```yaml
tts:
  enabled: true        # 是否启用TTS功能
  api_key: "你的API密钥"  # 启航AI API密钥
  api_url: "https://api.qhaigc.net" # API服务器地址
  model: "qhai-tts:永雏塔菲" # 使用的TTS模型
  max_text_length: 300 # 最大文本长度
  stt_enabled: false   # 是否启用语音转文本功能
  stt_model: "qhai-stt:general" # 使用的语音转文本模型
```

### 位置记忆配置
```yaml
position:
  remember: true      # 是否记住窗口位置
  x: 1006             # 窗口X坐标
  y: 177              # 窗口Y坐标
```

### 表情自动重置配置
```yaml
emotion_reset:
  auto_reset: true       # 是否启用自动重置
  default_emotion: "默认" # 默认表情名称
  reset_delay: 5         # 重置延迟时间（秒）
```

表情自动重置功能会在显示特定表情一段时间后，自动切换回默认表情。默认表情通常是"happy"，
但您可以在配置中修改为任何存在的表情名称。

### 权限控制配置
```yaml
access_control:
  enabled: true        # 是否启用权限控制
  admins:              # 管理员ID列表
  - 123456789          # 你的QQ号
  whitelist: []        # 白名单用户ID列表
```

权限控制功能可以限制与桌宠互动的用户。只有在管理员列表或白名单中的用户才能与桌宠互动。
对于没有权限的用户，系统会自动移除文本中的表情标记，但不会激活桌宠表情切换和消息显示。

注意：权限控制只对桌面形象有效，对聊天窗口无效！！简单来说就是不让其他人和你老婆聊天！！

## 自定义形象

1. 将自定义形象图片放入 `image` 目录
2. 推荐使用透明背景的PNG格式以获得最佳效果
3. 图片文件名将作为表情名称，如 `happy.png` 
4. 插件启动、重载时会自动扫描并加载新图片

## 技术说明

1. 插件使用PyQt5创建独立窗口进程
2. 文本框和图片窗口分离
3. 图片目录会自动生成emotions.json配置文件
4. 采用事件驱动架构，确保UI响应流畅
5. 使用多进程避免主线程阻塞
6. 语音功能全面集成启航AI服务：
   - TTS（文本转语音）实现桌宠说话能力
   - STT（语音转文本）实现用户语音输入
   - 音频分析实现情绪和意图识别
7. 使用ffmpeg和silk_v3_encoder将音频转换为QQ/微信支持的格式
8. 自动清理机制，定期删除过期的音频缓存文件

## 常见问题

- **如果窗口无法正常显示**：检查是否正确安装了PyQt5
- **如果表情无法切换**：检查image目录中是否有对应的图片文件
- **如果对话框不显示文字**：检查配置文件中的chat_bubble设置
- **如果新增表情不生效**：重启插件或框架，让它重新扫描image目录
- **如果语音功能不工作**：检查TTS配置和API密钥是否正确
- **如果语音没有发送到聊天窗口**：检查ffmpeg目录中是否有必要的转换工具 

## 鸣谢

感谢启航AI提供的TTS服务，感谢启航AI提供的API密钥，感谢启航AI提供的模型，感谢启航AI提供的API服务器地址！！

本模型TTS使用启航AI的TTS服务所以暂时不支持自定义TTS模型！！只能接入启航AI的TTS服务！！

本插件后续所有api均使用启航AI的api，所以需要使用启航AI的API密钥，请自行申请！！https://api.qhaigc.net/
